<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CTU Buddy | Share Resources</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Sora:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/global.css" />
    <!-- Global styles -->
    <link rel="stylesheet" href="../css/header.css" />
    <!-- Header styles -->
    <link rel="stylesheet" href="../css/share_resources.css" />
    <!-- Share Resources page specific styles -->
    <link rel="stylesheet" href="../css/footer.css" />
    <!-- Footer styles -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />

    <!-- Favicon -->
    <link rel="icon" href="../images/favicon.jpg" type="image/x-icon" />

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
    <div class="wrapper">
      <!-- Header -->
      <header>
        <div class="logo">
          <a href="../index.html"
            ><img src="../assets/images/logo_white.png" alt="CTU-Buddy Logo"
          /></a>
        </div>
        <span id="open-nav"><i class="bi bi-list"></i></span>
        <nav id="nav" class="hide">
          <ul class="nav-links">
            <span id="close-nav"><i class="bi bi-box-arrow-right"></i></span>
            <li><a href="../index.html">Home</a></li>
            <li><a href="timetable.html">Timetable</a></li>
            <li><a href="discussion.html">Discussion</a></li>
            <li><a href="share_resources.html">Share Resources</a></li>
            <li><a href="about_us.html">About Us</a></li>
            <li><a href="contact_us.html">Contact Us</a></li>
          </ul>
        </nav>
      </header>

      <!-- Main content -->
      <main>
        <section class="resources">
          <h1>Share Educational Resources</h1>
          <div class="form-container">
            <form id="upload-form" enctype="multipart/form-data">
              <!-- Instructional Text -->
              <p>Please select a PDF file to upload.</p>

              <!-- File Upload Button -->
              <label for="resource" class="custom-file-upload">
                <span id="file-chosen">Choose File</span>
              </label>
              <input
                type="file"
                id="resource"
                name="resource"
                accept="application/pdf"
                required
              />

              <!-- Submit Button -->
              <button type="submit" class="btn">Upload</button>
            </form>

            <!-- Upload status message -->
            <div id="upload-status" class="upload-message"></div>
            <!-- View PDF link (Initially hidden) -->
            <div id="view-pdf"></div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="container footer-content">
          <div class="footer-logo">
            <img src="../images/logo_color.png" alt="CTU-Buddy Logo" />
          </div>
          <div class="footer-columns">
            <div class="footer-column">
              <h3>Quick Links</h3>
              <ul>
                <li><a href="../pages/timetable.html">Timetable</a></li>
                <li><a href="../pages/discussion.html">Discussion</a></li>
                <li>
                  <a href="../pages/share_resources.html">Share Resources</a>
                </li>
                <li><a href="../pages/about_us.html">About Us</a></li>
                <li><a href="../pages/contact_us.html">Contact Us</a></li>
              </ul>
            </div>
            <div class="footer-column">
              <h3>Follow Us</h3>
              <ul class="social-icons">
                <li>
                  <a href="#"><i class="fab fa-facebook-f"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fab fa-instagram"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fab fa-tiktok"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fab fa-youtube"></i></a>
                </li>
                <li>
                  <a href="#"><i class="fab fa-linkedin-in"></i></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <div class="footer-bottom">
      <li>insertGroupname</li>
      <li>&copy; 2024</li>
    </div>

    <script src="../js/header.js"></script>
    <script>
      // Update label with the selected file's name
      document.getElementById("resource").addEventListener("change", function () {
        const fileName = this.files[0].name;
        document.getElementById("file-chosen").textContent = fileName
          ? fileName
          : "Choose File";
      });

      // Handle form submission and file upload
      document.getElementById('upload-form').addEventListener('submit', async function (event) {
        event.preventDefault();

        const formData = new FormData(this);
        const uploadStatus = document.getElementById('upload-status');
        const viewPDF = document.getElementById('view-pdf');
        uploadStatus.innerHTML = 'Uploading...';
        uploadStatus.className = ''; // Clear status class
        viewPDF.style.display = 'none'; // Hide View PDF link during upload

        try {
          const response = await fetch('http://localhost:3000/upload', {
            method: 'POST',
            body: formData,
          });

          if (response.ok) {
            const data = await response.json();
            // Show success message in green
            uploadStatus.className = 'success';
            uploadStatus.innerHTML = 'File uploaded successfully!';

            // Create links for viewing and downloading the PDF
            viewPDF.innerHTML = `
              <a href="${data.downloadURL}" target="_blank">View PDF in New Tab</a><br>
              <a href="${data.downloadURL}" id="download-link">Download PDF</a>
            `;
            viewPDF.style.display = 'block'; // Make the links visible

            // Add event listener to download link to trigger download only without opening in the same window
            const downloadLink = document.getElementById('download-link');
            downloadLink.addEventListener('click', (e) => {
              e.preventDefault();
              const link = document.createElement('a');
              link.href = data.downloadURL;
              link.setAttribute('download', ''); // Triggers the download
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link); // Clean up the temporary link
            });
          } else {
            uploadStatus.className = 'error'; // Show error message in red
            uploadStatus.innerHTML = 'Failed to upload file. Please try again.';
          }
        } catch (error) {
          console.error('Error uploading file:', error);
          uploadStatus.className = 'error'; // Show error message in red
          uploadStatus.innerHTML = 'Error uploading file. Please try again.';
        }
      });
    </script>
  </body>
</html>
